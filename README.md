# CalDAV LLM Bot

Telegram bot for natural language interaction with CalDAV calendar using LLM (Large Language Model).

WARNING!

This code was generated by Cursor/Claude-3.5-sonnet. Read it at your own risk!

The author takes no responsibility for:

Eye fatigue  
Brain overload  
Blown minds  
Any other injuries resulting from trying to understand this code  
If you're still here and want to proceed - good luck! You have been warned.

## About

This bot (@caldavllm_bot) allows you to connect your CalDAV calendar and then send it messages like "shoes ready on 4th" or "pick up order from 30th to 4th", or simply forward messages about doctor appointments. The bot parses these messages using LLM, creates calendar events, and adds them to your calendar.

Under the hood, it uses LLM parsing (specifically Deepseek, which is incredibly cost-effective - the entire testing phase with thousands of requests cost less than $1). The parsing is done using a comprehensive two-page prompt (available in the source code).

You can either:
- Use the existing instance (@caldavllm_bot) - limited to ~20 uses per day
- Deploy your own instance using Docker Compose (instructions below)

Note: If your calendar is not hosted on Google or Fastmail, you'll need to look up the CalDAV address for your service.

## Usage

### Calendar Setup

The bot supports several ways to connect your calendar:

#### Google Calendar:
```
/google username password [calendar]
```

❗️ **username** - your username (with or without @gmail.com)
❗️ **password** - your app password. To get it:
1. Enable Two-Factor Authentication (2FA)
   • App passwords are not available without 2FA
   • Regular account password won't work

2. Create an app password:
   • Go to https://myaccount.google.com/apppasswords or navigate to Security->2-Step Verification->App passwords
   • Enter a name (e.g., 'Calendar Bot')
   • Use the generated password in the command above

❗️ **calendar** - your calendar name (optional)
   • If not specified, the primary calendar will be used

#### FastMail:
```
/fastmail username password [calendar]
```

❗️ **username** - your username (with or without @fastmail.com)
❗️ **password** - your app password. To get it:
1. Go to https://app.fastmail.com/settings/security/apps
2. Click 'New App Password'
3. Select 'Calendars (CalDAV)' (this way the bot will only have access to calendar, not your entire mail) and choose a name, e.g., 'Calendar Bot'
4. Use the generated password in the command above

❗️ **calendar** - your calendar name (optional)
   • If not specified, the primary calendar will be used

#### Other CalDAV calendars:
```
/caldav username password url calendar_name
```

Example:
```
/caldav user@fastmail.com strong_password https://caldav.fastmail.com/dav/ main_calendar
```

### Adding Events

After setup, simply send messages about events in natural language, for example:
- "Meeting with client tomorrow at 3 PM"
- "Japanese symbolism lecture on March 25th at 11 AM"
- "Office meeting on Monday at 10:00"

The bot will parse your message and add the event to your calendar.

## Docker Compose Setup

1. Create a `docker-compose.yml` file:

```yaml
volumes:
  caldavllm_bot:
  
services:
  caldavllm_bot:
    image: ghcr.io/vvzvlad/caldavllm_bot:latest
    container_name: caldavllm_bot
    restart: unless-stopped
    volumes:
      - caldavllm_bot:/app/data
    environment:
      TZ: Europe/Moscow
      BOT_TOKEN: YOUR_TELEGRAM_BOT_TOKEN
      # At least one API key is required:
      DEEPSEEK_API_KEY: YOUR_DEEPSEEK_API_KEY  # Optional
      GROQ_API_KEY: YOUR_GROQ_API_KEY          # Optional
      # Provider selection:
      LLM_PROVIDER: groq                       # groq or deepseek
      MODEL: openai/gpt-oss-120b               # Optional
      # Optional settings:
      # DAILY_TOKEN_LIMIT: 30000
      # MESSAGE_BATCH_TIMEOUT: 0.8
      # MAX_BATCH_SIZE: 30
    logging:
      driver: "json-file"
      options:
        max-file: 5
        max-size: 10m
    labels:
      com.centurylinklabs.watchtower.enable: true
```

2. Replace environment variables with your values:
   - `BOT_TOKEN`: Your Telegram bot token (get from [@BotFather](https://t.me/BotFather))
   - LLM Provider API Keys (at least one required):
     - `DEEPSEEK_API_KEY`: API key for DeepSeek (https://platform.deepseek.com/)
     - `GROQ_API_KEY`: API key for Groq (https://console.groq.com/)
   - `LLM_PROVIDER`: Which provider to use - `groq` (default) or `deepseek`
   - `MODEL`: Model to use (default: `openai/gpt-oss-120b`)
   - `TZ`: Timezone for both the bot and CalDAV events (default: `Europe/Moscow`)
   - Optional settings:
     - `DAILY_TOKEN_LIMIT`: Daily token limit per user (default: `30000`)
     - `MESSAGE_BATCH_TIMEOUT`: Timeout for message batching in seconds (default: `0.8`)
     - `MAX_BATCH_SIZE`: Maximum messages in a batch (default: `30`)

3. Start the container:
```bash
docker-compose up -d
```


## License

MIT License


